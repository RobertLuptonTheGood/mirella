/*******************************************************************/
/*
 * Support for `hardware' character sets
 */
#include "mirella.h"

#define M_NCHAR   96                    /* how many characters */

static u_char *c_tabp[M_NCHAR];  /* pointers into c_tab[] */
u_char *c_mask;                  /* pointer to mask array */
normal m_fontindex = -1;          


u_char **m_ctab = 0;			/* this allows Mirella access and, in
					   principle, font changes */
normal m_chgt = 0 ;			/* height of chars in m_ctab */
normal m_cwid = 0 ;			/* width of chars */
normal m_ctsz = 0 ;			/* M_NCHAR*m_chgt */
u_char *m_cmask;			/* dot mask */

/********** FONT 0: HESTER'S 8x12 CHARACTER GENERATOR TABLE ***************/

#define M_CHGT12  12            /* height of chars in m_ctab */
#define M_CTSZ12  1152          /* M_NCHAR*M_CHGT */
#define M_CWID12  8             /* width of chars in font */

static u_char c_mask12[8] = { 0x80,0x40,0x20,0x10,0x08,0x04,0x02,0x01 };

static
u_char c_tab12[M_CTSZ12] = {
   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,	/* ' ' */
   0x00,0x00,0x10,0x10,0x00,0x10,0x10,0x10,0x10,0x10,0x10,0x10,	/* '!' */
   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x48,0x24,0x6c,0x6c,	/* '"' */
   0x00,0x00,0x00,0x24,0x24,0x7e,0x24,0x24,0x7e,0x24,0x24,0x00,	/* '#' */
   0x00,0x00,0x18,0x3c,0x5a,0x1a,0x1c,0x38,0x58,0x5a,0x3c,0x18,	/* '$' */
   0x00,0x00,0x40,0x26,0x26,0x10,0x10,0x08,0x08,0x64,0x64,0x02,	/* '%' */
   0x00,0x00,0x3a,0x44,0x4a,0x48,0x50,0x20,0x50,0x50,0x20,0x00, /* '&' */
   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x08,0x18,0x18,	/* ''' */
   0x00,0x00,0x08,0x10,0x20,0x20,0x20,0x20,0x20,0x20,0x10,0x08,	/* '(' */
   0x00,0x00,0x20,0x10,0x08,0x08,0x08,0x08,0x08,0x08,0x10,0x20,	/* ')' */
   0x00,0x00,0x00,0x42,0x24,0x18,0x7e,0x18,0x24,0x42,0x00,0x00,	/* '*' */
   0x00,0x00,0x00,0x10,0x10,0x10,0x7c,0x10,0x10,0x10,0x00,0x00,	/* '+' */
   0x10,0x08,0x18,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,	/* ',' */
   0x00,0x00,0x00,0x00,0x00,0x00,0x7e,0x00,0x00,0x00,0x00,0x00,	/* '-' */
   0x00,0x00,0x18,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,	/* '.' */
   0x00,0x00,0x40,0x20,0x20,0x10,0x10,0x08,0x08,0x04,0x04,0x02,	/* '/' */
   0x00,0x00,0x58,0x24,0x62,0x52,0x52,0x4a,0x4a,0x46,0x24,0x1a,	/* '0' */
   0x00,0x00,0x38,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x30,0x10,	/* '1' */
   0x00,0x00,0x7e,0x40,0x20,0x10,0x08,0x04,0x02,0x42,0x24,0x18,	/* '2' */
   0x00,0x00,0x3c,0x42,0x02,0x02,0x02,0x1c,0x02,0x02,0x42,0x3c,	/* '3' */
   0x00,0x00,0x04,0x04,0x04,0x04,0x7e,0x44,0x24,0x14,0x0c,0x04,	/* '4' */
   0x00,0x00,0x3c,0x42,0x42,0x02,0x02,0x3c,0x40,0x40,0x40,0x7e,	/* '5' */
   0x00,0x00,0x3c,0x42,0x42,0x42,0x7c,0x40,0x20,0x10,0x08,0x04,	/* '6' */
   0x00,0x00,0x20,0x20,0x10,0x10,0x08,0x08,0x04,0x04,0x02,0x7e,	/* '7' */
   0x00,0x00,0x3c,0x42,0x42,0x42,0x42,0x3c,0x42,0x42,0x42,0x3c,	/* '8' */
   0x00,0x00,0x20,0x10,0x08,0x04,0x3c,0x42,0x42,0x42,0x42,0x3c,	/* '9' */
   0x00,0x00,0x00,0x18,0x18,0x00,0x00,0x00,0x18,0x18,0x00,0x00,	/* ':' */
   0x10,0x08,0x18,0x18,0x00,0x00,0x00,0x18,0x18,0x00,0x00,0x00,	/* ';' */
   0x00,0x00,0x04,0x08,0x10,0x20,0x40,0x20,0x10,0x08,0x04,0x00,	/* '<' */
   0x00,0x00,0x00,0x00,0x00,0x7e,0x00,0x00,0x7e,0x00,0x00,0x00,	/* '=' */
   0x00,0x00,0x40,0x20,0x10,0x08,0x04,0x08,0x10,0x20,0x40,0x00,	/* '>' */
   0x00,0x00,0x10,0x00,0x10,0x10,0x10,0x08,0x04,0x44,0x44,0x38,	/* '?' */
   0x00,0x00,0x1c,0x22,0x40,0x5c,0x52,0x52,0x4e,0x42,0x24,0x18,	/* '@' */
   0x00,0x00,0x42,0x42,0x42,0x42,0x42,0x7e,0x42,0x42,0x24,0x18,	/* 'A' */
   0x00,0x00,0x7c,0x22,0x22,0x22,0x22,0x3c,0x22,0x22,0x22,0x7c,	/* 'B' */
   0x00,0x00,0x1c,0x22,0x40,0x40,0x40,0x40,0x40,0x40,0x22,0x1c,	/* 'C' */
   0x00,0x00,0x78,0x24,0x22,0x22,0x22,0x22,0x22,0x22,0x24,0x78,	/* 'D' */
   0x00,0x00,0x7e,0x40,0x40,0x40,0x40,0x78,0x40,0x40,0x40,0x7e,	/* 'E' */
   0x00,0x00,0x40,0x40,0x40,0x40,0x40,0x78,0x40,0x40,0x40,0x7e,	/* 'F' */
   0x00,0x00,0x1c,0x22,0x42,0x4e,0x40,0x40,0x40,0x40,0x22,0x1c,	/* 'G' */
   0x00,0x00,0x42,0x42,0x42,0x42,0x42,0x7e,0x42,0x42,0x42,0x42,	/* 'H' */
   0x00,0x00,0x38,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x38,	/* 'I' */
   0x00,0x00,0x38,0x44,0x02,0x02,0x02,0x02,0x02,0x02,0x02,0x02,	/* 'J' */
   0x00,0x00,0x42,0x44,0x48,0x50,0x60,0x60,0x50,0x48,0x44,0x42,	/* 'K' */
   0x00,0x00,0x7e,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x40,	/* 'L' */
   0x00,0x00,0x42,0x42,0x42,0x42,0x42,0x5a,0x5a,0x66,0x66,0x42,	/* 'M' */
   0x00,0x00,0x42,0x46,0x46,0x4a,0x4a,0x52,0x52,0x62,0x62,0x42,	/* 'N' */
   0x00,0x00,0x18,0x24,0x42,0x42,0x42,0x42,0x42,0x42,0x24,0x18,	/* 'O' */
   0x00,0x00,0x40,0x40,0x40,0x40,0x40,0x7c,0x42,0x42,0x42,0x7c,	/* 'P' */
   0x00,0x00,0x1a,0x24,0x4a,0x42,0x42,0x42,0x42,0x42,0x24,0x18,	/* 'Q' */
   0x00,0x00,0x42,0x42,0x44,0x44,0x48,0x7c,0x42,0x42,0x42,0x7c, /* 'R' */
   0x00,0x00,0x3c,0x42,0x02,0x02,0x02,0x3c,0x40,0x40,0x42,0x3c,	/* 'S' */
   0x00,0x00,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x7c,	/* 'T' */
   0x00,0x00,0x3c,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x42,0x42,	/* 'U' */
   0x00,0x00,0x18,0x18,0x24,0x24,0x24,0x24,0x42,0x42,0x42,0x42,	/* 'V' */
   0x00,0x00,0x42,0x66,0x66,0x5a,0x5a,0x42,0x42,0x42,0x42,0x42,	/* 'W' */
   0x00,0x00,0x42,0x42,0x24,0x24,0x18,0x18,0x24,0x24,0x42,0x42,	/* 'X' */
   0x00,0x00,0x10,0x10,0x10,0x10,0x10,0x10,0x28,0x44,0x44,0x44,	/* 'Y' */
   0x00,0x00,0x7e,0x20,0x20,0x10,0x10,0x08,0x08,0x04,0x04,0x7e,	/* 'Z' */
   0x00,0x00,0x1c,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x1c,	/* '[' */
   0x00,0x00,0x02,0x04,0x04,0x08,0x08,0x10,0x10,0x20,0x20,0x40,	/* '\' */
   0x00,0x00,0x38,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x38,	/* ']' */
   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x22,0x14,0x08,	/* '^' */
   0xff,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,	/* '_' */
   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x08,0x10,0x20,0x40,	/* '`' */
   0x00,0x00,0x3c,0x48,0x48,0x38,0x08,0x70,0x00,0x00,0x00,0x00,	/* 'a' */
   0x00,0x00,0x58,0x64,0x44,0x44,0x64,0x58,0x40,0x40,0x40,0x40,	/* 'b' */
   0x00,0x00,0x38,0x44,0x40,0x40,0x44,0x38,0x00,0x00,0x00,0x00,	/* 'c' */
   0x00,0x00,0x34,0x4c,0x44,0x44,0x4c,0x34,0x04,0x04,0x04,0x04,	/* 'd' */
   0x00,0x00,0x38,0x44,0x40,0x7c,0x44,0x38,0x00,0x00,0x00,0x00,	/* 'e' */
   0x00,0x00,0x20,0x20,0x20,0x20,0x20,0x70,0x20,0x24,0x24,0x18,	/* 'f' */
   0x00,0x78,0x04,0x3c,0x44,0x44,0x44,0x3c,0x00,0x00,0x00,0x00,	/* 'g' */
   0x00,0x00,0x44,0x44,0x44,0x44,0x44,0x78,0x40,0x40,0x40,0x40,	/* 'h' */
   0x00,0x00,0x38,0x10,0x10,0x10,0x10,0x30,0x00,0x10,0x00,0x00,	/* 'i' */
   0x00,0x38,0x44,0x04,0x04,0x04,0x04,0x0c,0x00,0x04,0x00,0x00,	/* 'j' */
   0x00,0x00,0x44,0x48,0x50,0x60,0x50,0x48,0x44,0x40,0x40,0x40,	/* 'k' */
   0x00,0x00,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x18,	/* 'l' */
   0x00,0x00,0x54,0x54,0x54,0x54,0x7c,0x40,0x00,0x00,0x00,0x00,	/* 'm' */
   0x00,0x00,0x44,0x44,0x44,0x44,0x78,0x40,0x00,0x00,0x00,0x00,	/* 'n' */
   0x00,0x00,0x38,0x44,0x44,0x44,0x44,0x38,0x00,0x00,0x00,0x00,	/* 'o' */
   0x00,0x40,0x40,0x78,0x44,0x44,0x44,0x78,0x00,0x00,0x00,0x00,	/* 'p' */
   0x00,0x04,0x04,0x3c,0x44,0x44,0x44,0x3c,0x00,0x00,0x00,0x00,	/* 'q' */
   0x00,0x00,0x40,0x40,0x40,0x40,0x64,0x58,0x00,0x00,0x00,0x00,	/* 'r' */
   0x00,0x00,0x78,0x04,0x04,0x38,0x40,0x3c,0x00,0x00,0x00,0x00,	/* 's' */
   0x00,0x00,0x18,0x20,0x20,0x20,0x20,0x78,0x20,0x00,0x00,0x00,	/* 't' */
   0x00,0x00,0x34,0x4c,0x44,0x44,0x44,0x44,0x00,0x00,0x00,0x00,	/* 'u' */
   0x00,0x00,0x10,0x28,0x28,0x44,0x44,0x44,0x00,0x00,0x00,0x00,	/* 'v' */
   0x00,0x00,0x28,0x54,0x54,0x54,0x44,0x44,0x00,0x00,0x00,0x00,	/* 'w' */
   0x00,0x00,0x44,0x28,0x10,0x10,0x28,0x44,0x00,0x00,0x00,0x00,	/* 'x' */
   0x00,0x70,0x08,0x3c,0x44,0x44,0x44,0x44,0x00,0x00,0x00,0x00,	/* 'y' */
   0x00,0x00,0x7c,0x40,0x20,0x10,0x08,0x7c,0x00,0x00,0x00,0x00,	/* 'z' */
   0x00,0x0c,0x10,0x10,0x10,0x10,0x20,0x10,0x10,0x10,0x10,0x0c,	/* '{' */
   0x00,0x00,0x10,0x10,0x10,0x10,0x00,0x00,0x10,0x10,0x10,0x10,	/* '|' */
   0x00,0x30,0x08,0x08,0x08,0x08,0x04,0x08,0x08,0x08,0x08,0x30,	/* '}' */
   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x48,0x54,0x24,0x00,0x00, /* '~' */
   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,	/* 7F  */
   };

/********** FONT 1:  5x7 CHARACTER GENERATOR TABLE **********************/

#define M_CHGT7  7           /* height of chars in m_ctab */
#define M_CTSZ7 672          /* M_NCHAR*M_CHGT */
#define M_CWID7  6             /* width of chars in font */

static u_char c_mask7[6] = { 0x01,0x02,0x04,0x08,0x10,0x20};

static
u_char c_tab7[M_CTSZ7] = {
    0x00,0x00,0x00,0x00,0x00,0x00,0x00, /* ' ' */
    0x00,0x04,0x00,0x04,0x04,0x04,0x04, /* '!' */
    0x00,0x00,0x00,0x00,0x00,0x0a,0x0a, /* '"' */
    0x00,0x0a,0x1f,0x0a,0x1f,0x0a,0x00, /* '#' */
    0x04,0x0f,0x14,0x0e,0x05,0x1e,0x04, /* '$' */
    0x00,0x11,0x02,0x04,0x04,0x08,0x11, /* '%' */
    0x00,0x16,0x09,0x1a,0x04,0x0a,0x04, /* '&' */
    0x00,0x00,0x00,0x00,0x00,0x04,0x08, /* ''' */
    0x00,0x04,0x02,0x02,0x02,0x02,0x04, /* '(' */
    0x00,0x04,0x08,0x08,0x08,0x08,0x04, /* ')' */
    0x00,0x11,0x0a,0x1f,0x0a,0x11,0x00, /* '*' */
    0x00,0x04,0x04,0x1f,0x04,0x04,0x00, /* '+' */
    0x02,0x04,0x00,0x00,0x00,0x00,0x00, /* ',' */
    0x00,0x00,0x00,0x1e,0x00,0x00,0x00, /* '-' */
    0x00,0x04,0x00,0x00,0x00,0x00,0x00, /* '.' */
    0x00,0x01,0x02,0x04,0x04,0x08,0x10, /* '/' */
    0x00,0x0e,0x11,0x13,0x15,0x19,0x0e, /* '0' */
    0x00,0x0e,0x04,0x04,0x04,0x06,0x04, /* '1' */
    0x00,0x1f,0x06,0x08,0x10,0x11,0x0e, /* '2' */
    0x00,0x0e,0x11,0x10,0x0c,0x11,0x0e, /* '3' */
    0x00,0x08,0x08,0x1f,0x0a,0x0c,0x08, /* '4' */
    0x00,0x0e,0x11,0x10,0x0f,0x01,0x1f, /* '5' */
    0x00,0x0e,0x11,0x11,0x0f,0x01,0x0e, /* '6' */
    0x00,0x02,0x02,0x04,0x08,0x10,0x1f, /* '7' */
    0x00,0x0e,0x11,0x11,0x0e,0x11,0x0e, /* '8' */
    0x00,0x0e,0x10,0x1e,0x11,0x11,0x0e, /* '9' */
    0x00,0x04,0x00,0x00,0x04,0x00,0x00, /* ':' */
    0x02,0x04,0x00,0x00,0x04,0x00,0x00, /* ';' */
    0x00,0x08,0x04,0x02,0x04,0x08,0x00, /* '<' */
    0x00,0x00,0x0e,0x00,0x0e,0x00,0x00, /* '=' */
    0x00,0x02,0x04,0x08,0x04,0x02,0x00, /* '>' */
    0x04,0x00,0x04,0x08,0x10,0x12,0x0c, /* '?' */
    0x00,0x0e,0x01,0x0d,0x15,0x11,0x0e, /* '@' */
    0x00,0x11,0x11,0x1f,0x11,0x0a,0x04, /* 'A' */
    0x00,0x0f,0x11,0x11,0x0f,0x11,0x0f, /* 'B' */
    0x00,0x0e,0x11,0x01,0x01,0x11,0x0e, /* 'C' */
    0x00,0x07,0x09,0x11,0x11,0x09,0x07, /* 'D' */
    0x00,0x1f,0x01,0x01,0x07,0x01,0x1f, /* 'E' */
    0x00,0x01,0x01,0x01,0x07,0x01,0x1f, /* 'F' */
    0x00,0x0e,0x11,0x1d,0x01,0x11,0x0e, /* 'G' */
    0x00,0x11,0x11,0x11,0x1f,0x11,0x11, /* 'H' */
    0x00,0x0e,0x04,0x04,0x04,0x04,0x0e, /* 'I' */
    0x00,0x02,0x05,0x04,0x04,0x04,0x1f, /* 'J' */
    0x00,0x11,0x11,0x09,0x07,0x09,0x11, /* 'K' */
    0x00,0x1f,0x01,0x01,0x01,0x01,0x01, /* 'L' */
    0x00,0x11,0x11,0x11,0x15,0x1b,0x11, /* 'M' */
    0x00,0x11,0x19,0x15,0x15,0x13,0x11, /* 'N' */
    0x00,0x0e,0x11,0x11,0x11,0x11,0x0e, /* 'O' */
    0x00,0x01,0x01,0x0f,0x11,0x11,0x0f, /* 'P' */
    0x00,0x0e,0x19,0x15,0x11,0x11,0x0e, /* 'Q' */
    0x00,0x11,0x09,0x0f,0x11,0x11,0x0f, /* 'R' */
    0x00,0x0e,0x11,0x10,0x0e,0x01,0x0e, /* 'S' */
    0x00,0x04,0x04,0x04,0x04,0x04,0x1f, /* 'T' */
    0x00,0x0e,0x11,0x11,0x11,0x11,0x11, /* 'U' */
    0x00,0x04,0x0a,0x0a,0x11,0x11,0x11, /* 'V' */
    0x00,0x11,0x1b,0x15,0x11,0x11,0x11, /* 'W' */
    0x00,0x11,0x11,0x0a,0x04,0x0a,0x11, /* 'X' */
    0x00,0x04,0x04,0x04,0x0a,0x11,0x11, /* 'Y' */
    0x00,0x1f,0x01,0x02,0x04,0x08,0x1f, /* 'Z' */
    0x00,0x0e,0x02,0x02,0x02,0x02,0x0e, /* '[' */
    0x00,0x10,0x08,0x04,0x04,0x02,0x01, /* '\' */
    0x00,0x0e,0x08,0x08,0x08,0x08,0x0e, /* ']' */
    0x00,0x00,0x00,0x00,0x11,0x0a,0x04, /* '^' */
    0x00,0x3f,0x00,0x00,0x00,0x00,0x00, /* '_' */
    0x00,0x00,0x00,0x00,0x00,0x04,0x02, /* '`' */
    0x00,0x1c,0x12,0x1c,0x10,0x0c,0x00, /* 'a' */
    0x00,0x0e,0x12,0x12,0x0e,0x02,0x02, /* 'b' */
    0x00,0x1c,0x02,0x02,0x1c,0x00,0x00, /* 'c' */
    0x00,0x1c,0x12,0x12,0x1c,0x10,0x10, /* 'd' */
    0x00,0x0c,0x02,0x1e,0x12,0x0c,0x00, /* 'e' */
    0x00,0x04,0x04,0x1e,0x04,0x04,0x18, /* 'f' */
    0x0c,0x10,0x1c,0x12,0x1c,0x00,0x00, /* 'g' */
    0x00,0x12,0x12,0x12,0x0e,0x02,0x02, /* 'h' */
    0x00,0x08,0x08,0x08,0x00,0x08,0x00, /* 'i' */
    0x04,0x0a,0x08,0x08,0x00,0x08,0x00, /* 'j' */
    0x00,0x12,0x0a,0x0e,0x12,0x02,0x02, /* 'k' */
    0x00,0x08,0x08,0x08,0x08,0x08,0x0c, /* 'l' */
    0x00,0x11,0x15,0x15,0x0a,0x00,0x00, /* 'm' */
    0x00,0x14,0x14,0x14,0x0a,0x00,0x00, /* 'n' */
    0x00,0x0c,0x12,0x12,0x0c,0x00,0x00, /* 'o' */
    0x02,0x0e,0x12,0x12,0x0d,0x00,0x00, /* 'p' */
    0x10,0x1c,0x12,0x12,0x1c,0x00,0x00, /* 'q' */
    0x00,0x02,0x02,0x16,0x0a,0x00,0x00, /* 'r' */
    0x00,0x0e,0x10,0x0c,0x02,0x0c,0x00, /* 's' */
    0x00,0x08,0x14,0x04,0x1e,0x04,0x04, /* 't' */
    0x00,0x0c,0x12,0x12,0x12,0x00,0x00, /* 'u' */
    0x00,0x0c,0x0c,0x12,0x12,0x00,0x00, /* 'v' */
    0x00,0x0a,0x15,0x11,0x11,0x00,0x00, /* 'w' */
    0x00,0x12,0x0c,0x0c,0x12,0x00,0x00, /* 'x' */
    0x0c,0x10,0x1c,0x12,0x12,0x00,0x00, /* 'y' */
    0x00,0x1e,0x04,0x08,0x1e,0x00,0x00, /* 'z' */
    0x0c,0x02,0x02,0x01,0x02,0x02,0x0c, /* '{' */
    0x00,0x04,0x04,0x00,0x00,0x04,0x04, /* '|' */
    0x06,0x08,0x08,0x10,0x08,0x08,0x06, /* '}' */
    0x00,0x00,0x00,0x00,0x00,0x0a,0x14, /* '~' */
    0x00,0x00,0x00,0x00,0x00,0x00,0x00  /* 7F  */
   };

/****************** GENERAL CHARACTER GENERATOR ***************************/

void
setfont(nfont)
int nfont;				/* which font? */
{   
   u_char *pb;
   int i;
   
   if(nfont == m_fontindex) return;	/* no change */
   
   switch(nfont) {
    case 0:
      m_chgt = M_CHGT12;
      m_cwid = M_CWID12;
      m_ctsz = M_CTSZ12;
      m_cmask = c_mask12;
      m_ctab = c_tabp;
      m_fontindex = 0;
      pb = c_tab12;
      break;
    case 1:        
      m_chgt = M_CHGT7;
      m_cwid = M_CWID7;
      m_ctsz = M_CTSZ7;
      m_ctab = c_tabp;
      m_cmask = c_mask7;
      m_fontindex = 1;
      pb = c_tab7;
      break;
    default:
      mprintf("\nSETFONT: No such font index as %d",nfont);
      m_fontindex = -1;   /* can reset the world by requesting a 
			     nonexistent font*/
      erret((char *)NULL);
   }
   for(i=0;i<M_NCHAR;i++){
      c_tabp[i] = (u_char *)(pb + i*m_chgt);
   }
}
        
int 
genchar(str,out,xout,scale)
char *str;			/* String to be converted to dot pattern */
u_char **out;			/* Output array (bytes; one per dot) */
int xout;			/* Length of output array */
int scale;			/* Factor for blowing up characters */
{
    int i, j, k, nchar, x, c;
    
    scale = (scale<1) ? 1 : scale;
    nchar = strlen(str);
    x=0;
    
    if(!m_ctab) erret("\nGENCHAR: NO FONT");
    for(k=0; k<nchar; k++) {
       c = (str[k]&0x7f) - ' ';
       if(c<0) continue;
       for(i=0; i<8*scale; i++,x++) {
          if(x>=xout) return(x);
          for(j=0; j<12*scale; j++) {
            out[j][x] = (m_ctab[c][j/scale] & m_cmask[i/scale]) ? 0xff : 0;
          }
       }
    }
    return(x);
}
